(function(){
'use strict';function p(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function q(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:p(a)}}var r="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,u="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};
function v(a,b){if(b){var d=r;a=a.split(".");for(var f=0;f<a.length-1;f++){var h=a[f];h in d||(d[h]={});d=d[h]}a=a[a.length-1];f=d[a];b=b(f);b!=f&&null!=b&&u(d,a,{configurable:!0,writable:!0,value:b})}}
v("Promise",function(a){function b(c){this.b=0;this.g=void 0;this.a=[];var a=this.c();try{c(a.resolve,a.reject)}catch(e){a.reject(e)}}function d(){this.a=null}function f(a){return a instanceof b?a:new b(function(c){c(a)})}if(a)return a;d.prototype.b=function(a){if(null==this.a){this.a=[];var c=this;this.c(function(){c.g()})}this.a.push(a)};var h=r.setTimeout;d.prototype.c=function(a){h(a,0)};d.prototype.g=function(){for(;this.a&&this.a.length;){var a=this.a;this.a=[];for(var b=0;b<a.length;++b){var e=
a[b];a[b]=null;try{e()}catch(g){this.f(g)}}}this.a=null};d.prototype.f=function(a){this.c(function(){throw a;})};b.prototype.c=function(){function a(a){return function(c){e||(e=!0,a.call(b,c))}}var b=this,e=!1;return{resolve:a(this.o),reject:a(this.f)}};b.prototype.o=function(a){if(a===this)this.f(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof b)this.s(a);else{a:switch(typeof a){case "object":var c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.m(a):this.i(a)}};
b.prototype.m=function(a){var b=void 0;try{b=a.then}catch(e){this.f(e);return}"function"==typeof b?this.u(b,a):this.i(a)};b.prototype.f=function(a){this.j(2,a)};b.prototype.i=function(a){this.j(1,a)};b.prototype.j=function(a,b){if(0!=this.b)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.b);this.b=a;this.g=b;this.l()};b.prototype.l=function(){if(null!=this.a){for(var a=0;a<this.a.length;++a)n.b(this.a[a]);this.a=null}};var n=new d;b.prototype.s=function(a){var b=this.c();
a.h(b.resolve,b.reject)};b.prototype.u=function(a,b){var e=this.c();try{a.call(b,e.resolve,e.reject)}catch(g){e.reject(g)}};b.prototype.then=function(a,d){function e(a,b){return"function"==typeof a?function(b){try{c(a(b))}catch(x){f(x)}}:b}var c,f,k=new b(function(a,b){c=a;f=b});this.h(e(a,c),e(d,f));return k};b.prototype.catch=function(a){return this.then(void 0,a)};b.prototype.h=function(a,b){function e(){switch(c.b){case 1:a(c.g);break;case 2:b(c.g);break;default:throw Error("Unexpected state: "+
c.b);}}var c=this;null==this.a?n.b(e):this.a.push(e)};b.resolve=f;b.reject=function(a){return new b(function(b,e){e(a)})};b.race=function(a){return new b(function(b,e){for(var c=q(a),d=c.next();!d.done;d=c.next())f(d.value).h(b,e)})};b.all=function(a){var d=q(a),e=d.next();return e.done?f([]):new b(function(a,b){function c(b){return function(e){g[b]=e;h--;0==h&&a(g)}}var g=[],h=0;do g.push(void 0),h++,f(e.value).h(c(g.length-1),b),e=d.next();while(!e.done)})};return b});
v("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}});v("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}});var w=document.getElementsByClassName("timers")[0],y=[],z=!1;function A(){return{timers:y.map(function(a){return a.state()}),modal:z,hour:!!w&&w.classList.contains("hourmode")}}
var C=function(){function a(){}function b(b,g,l){f.classList.remove("prompt");h.textContent=b;for(n.textContent=g;c.firstChild;)c.removeChild(c.firstChild);b=q(l);for(g=b.next();!g.done;g=b.next())l=document.createElement("div"),l.textContent=g.value,c.appendChild(l);return new Promise(function(b){d.classList.add("visible");a=function(a){return b(a)}})}var d=document.querySelector(".modal-barrier"),f=d.querySelector(".dialog"),h=d.querySelector(".title"),n=d.querySelector(".text"),c=d.querySelector(".buttons"),
m=d.querySelector(".prompt");c.addEventListener("click",function(b){b.target.parentNode==c&&(a(b.target.textContent),a=function(){},d.classList.remove("visible"))});return{show:b,prompt:function(b,g,l){l=void 0===l?"":l;f.classList.add("prompt");m.value="";m.placeholder=l;h.textContent=b;for(n.textContent=g;c.firstChild;)c.removeChild(c.firstChild);b=q(["OK","Cancel"]);for(g=b.next();!g.done;g=b.next())l=document.createElement("div"),l.textContent=g.value,c.appendChild(l);return new Promise(function(b,
c){d.classList.add("visible");a=function(a){return"OK"==a?b(m.value):c("Cancel")}})},confirm:function(a){return b("Confirm",a,["OK","Cancel"]).then(function(a){if("OK"!=a)throw"Cancel";})}}}();
function D(){if(localStorage){var a=y.map(function(a){return a.label()});localStorage.setItem("timerNames",a.join("|"));localStorage.setItem("state",JSON.stringify(A()))}a=0;for(var b=!1,d=q(y),f=d.next();!f.done;f=d.next())f=f.value,f.state().summed&&(b=!0,a+=f.value());document.body.classList.toggle("summing",b);b&&(document.querySelector(".sum .time-hours").textContent=E(a),document.querySelector(".sum .time-minutes").textContent=G(a))}
function H(a){function b(){z&&I();e=+new Date;k.push({start:e,stop:e,running:!0});m.classList.add("started");h()}function d(){if(e){var a=+new Date;k[k.length-1].stop=a;k[k.length-1].running=!1;l+=a-e;e=void 0;m.classList.remove("started");h()}}function f(){k.splice(0,k.length);l=g=0;e&&(e=+new Date,k.push({start:e,stop:e,running:!0}));h()}function h(){var a=n();x.textContent=G(a);J.textContent=E(a);k.length&&k[k.length-1].running&&(k[k.length-1].stop=+new Date)}function n(){return(l+(e?new Date-
e:0))/1E3}function c(a){var b=m.getElementsByClassName(a);if(1>b.length)throw Error("could not find child "+a);return b[0]}a=void 0===a?{}:a;var m=document.querySelector(".template .timer").cloneNode(!0);w.insertBefore(m,w.lastElementChild);for(var e=void 0,g=a.adjust||0,l=g,k=a.history||[],B=q(k),t=B.next();!t.done;t=B.next())t=t.value,l+=t.stop-t.start;c("name").firstElementChild.value=a.name||"";m.classList.toggle("summed",a.summed);var J=c("time-hours"),x=c("time-minutes"),F={update:h,reset:f,
label:function(){return escape(c("name").firstElementChild.value)+"="+(e?-1:1)*n()},stop:d,state:function(){return{name:c("name").firstElementChild.value,history:k,adjust:g,summed:m.classList.contains("summed")}},value:n};k.length&&k[k.length-1].running&&b();c("start").addEventListener("click",b);c("pause").addEventListener("click",d);c("reset").addEventListener("click",f);c("sum").addEventListener("click",function(){m.classList.toggle("summed");D()});c("delete").addEventListener("click",function(){m.parentNode.removeChild(m);
y.splice(y.indexOf(F),1);D()});c("name").firstElementChild.addEventListener("blur",D);c("time").addEventListener("dblclick",function(){C.prompt("Adjust Time","Please enter a new time","00:00:00").then(function(a){if(a){for(var b=a.split(":");3>b.length;)b.unshift("0");b=b.map(Number);for(var d=q(b),c=d.next();!c.done;c=d.next())if(!Number.isInteger(c.value)||3<b.length){C.show("Error",'Could not parse time: "'+a+'"',["OK"]);return}a=1E3*(3600*b[0]+60*b[1]+b[2]);f();l+=a;g+=a;h()}})});y.push(F)}
document.querySelector(".new").addEventListener("click",function(){H();D()});document.querySelector(".hours").addEventListener("click",function(){w.classList.remove("hourmode")});document.querySelector(".minutes").addEventListener("click",function(){w.classList.add("hourmode")});document.querySelector(".modal").addEventListener("click",function(){z=!1;w.classList.remove("modal")});document.querySelector(".non-modal").addEventListener("click",function(){z=!0;w.classList.add("modal")});
document.getElementsByClassName("reset-all")[0].addEventListener("click",function(){C.confirm("Reset all timers?").then(function(){y.forEach(function(a){return a.reset()})})});document.body.addEventListener("keypress",function(a){"Enter"==a.key&&a.target.blur()});
var K=function(){if(!localStorage)return{modal:!1,timers:[]};var a=localStorage.getItem("state");if(a)return JSON.parse(a);var b={modal:!1,timers:[]};(localStorage.getItem("timerNames")||"").split("|").forEach(function(a){var d=a.indexOf("="),h={history:[],adjust:0};if(0<=d){var n=1E3*Number(a.substring(d+1));a=a.substring(0,d);0>n&&(n*=-1,d=+new Date,h.history.push({start:d,stop:d,v:!0}));h.adjust=n}a=unescape(a);h.name=a;b.timers.push(h)});return b}();w.classList.toggle("modal",z=K.modal);
w.classList.toggle("hourmode",K.hour);K.timers.forEach(function(a){return H(a)});function I(){y.forEach(function(a){return a.stop()})}function G(a){var b=Math.floor(a/3600),d=String(Math.floor(a%3600/60));a=String(Math.floor(a%60));2>d.length&&(d="0"+d);2>a.length&&(a="0"+a);return b+":"+d+":"+a}function E(a){var b=Math.round(a%3600/360);a=Math.floor(a/3600);10==b&&(b=0,a++);return a+"."+b+" h"}function L(){y.forEach(function(a){return a.update()});window.setTimeout(L,250);D()}L();
}).call(this)
