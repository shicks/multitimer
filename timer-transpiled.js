(function(){
'use strict';var n="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)},p="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function q(){q=function(){};p.Symbol||(p.Symbol=r)}var u=0;function r(a){return"jscomp_symbol_"+(a||"")+u++}
function v(){q();var a=p.Symbol.iterator;a||(a=p.Symbol.iterator=p.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&n(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return w(this)}});v=function(){}}function w(a){var b=0;return x(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})}function x(a){v();a={next:a};a[p.Symbol.iterator]=function(){return this};return a}function z(a){v();var b=a[Symbol.iterator];return b?b.call(a):w(a)}
function A(a,b){if(b){var d=p;a=a.split(".");for(var l=0;l<a.length-1;l++){var g=a[l];g in d||(d[g]={});d=d[g]}a=a[a.length-1];l=d[a];b=b(l);b!=l&&null!=b&&n(d,a,{configurable:!0,writable:!0,value:b})}}
A("Promise",function(a){function b(c){this.b=0;this.h=void 0;this.a=[];var a=this.f();try{c(a.resolve,a.reject)}catch(e){a.reject(e)}}function d(){this.a=null}if(a)return a;d.prototype.b=function(c){this.a||(this.a=[],this.f());this.a.push(c)};d.prototype.f=function(){var c=this;this.c(function(){c.h()})};var l=p.setTimeout;d.prototype.c=function(c){l(c,0)};d.prototype.h=function(){for(;this.a&&this.a.length;){var c=this.a;this.a=[];for(var a=0;a<c.length;++a){var b=c[a];delete c[a];try{b()}catch(h){this.g(h)}}}this.a=
null};d.prototype.g=function(a){this.c(function(){throw a;})};b.prototype.f=function(){function a(a){return function(c){e||(e=!0,a.call(b,c))}}var b=this,e=!1;return{resolve:a(this.o),reject:a(this.g)}};b.prototype.o=function(a){if(a===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof b)this.s(a);else{var c;a:switch(typeof a){case "object":c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.m(a):this.i(a)}};b.prototype.m=function(a){var c=void 0;
try{c=a.then}catch(e){this.g(e);return}"function"==typeof c?this.u(c,a):this.i(a)};b.prototype.g=function(a){this.j(2,a)};b.prototype.i=function(a){this.j(1,a)};b.prototype.j=function(a,b){if(0!=this.b)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.b);this.b=a;this.h=b;this.l()};b.prototype.l=function(){if(this.a){for(var a=this.a,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.a=null}};var g=new d;b.prototype.s=function(a){var b=this.f();a.c(b.resolve,b.reject)};b.prototype.u=
function(a,b){var c=this.f();try{a.call(b,c.resolve,c.reject)}catch(h){c.reject(h)}};b.prototype.then=function(a,d){function c(a,b){return"function"==typeof a?function(b){try{h(a(b))}catch(y){k(y)}}:b}var h,k,f=new b(function(a,b){h=a;k=b});this.c(c(a,h),c(d,k));return f};b.prototype.catch=function(a){return this.then(void 0,a)};b.prototype.c=function(a,b){function c(){switch(d.b){case 1:a(d.h);break;case 2:b(d.h);break;default:throw Error("Unexpected state: "+d.b);}}var d=this;this.a?this.a.push(function(){g.b(c)}):
g.b(c)};b.resolve=function(a){return a instanceof b?a:new b(function(b){b(a)})};b.reject=function(a){return new b(function(b,c){c(a)})};b.b=function(a){return new b(function(c,d){for(var h=z(a),e=h.next();!e.done;e=h.next())b.resolve(e.value).c(c,d)})};b.a=function(a){var c=z(a),d=c.next();return d.done?b.resolve([]):new b(function(a,e){function f(b){return function(c){h[b]=c;k--;k||a(h)}}var h=[],k=0;do h.push(void 0),k++,b.resolve(d.value).c(f(h.length-1),e),d=c.next();while(!d.done)})};b.$jscomp$new$AsyncExecutor=
function(){return new d};return b});A("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}});A("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}});var B=document.getElementsByClassName("timers")[0],C=[],D=!1;function F(){return{timers:C.map(function(a){return a.state()}),modal:D,hour:!!B&&B.classList.contains("hourmode")}}
var H=function(){function a(){}function b(b,e,f){l.classList.remove("prompt");g.textContent=b;for(c.textContent=e;m.firstChild;)m.removeChild(m.firstChild);b=z(f);for(e=b.next();!e.done;e=b.next())f=document.createElement("div"),f.textContent=e.value,m.appendChild(f);return new Promise(function(b){d.classList.add("visible");a=function(a){return b(a)}})}var d=document.querySelector(".modal-barrier"),l=d.querySelector(".dialog"),g=d.querySelector(".title"),c=d.querySelector(".text"),m=d.querySelector(".buttons"),
e=d.querySelector(".prompt");m.addEventListener("click",function(b){b.target.parentNode==m&&(a(b.target.textContent),a=function(){},d.classList.remove("visible"))});return{show:b,prompt:function(b,k,f){f=void 0===f?"":f;l.classList.add("prompt");e.value="";e.placeholder=f;g.textContent=b;for(c.textContent=k;m.firstChild;)m.removeChild(m.firstChild);b=z(["OK","Cancel"]);for(k=b.next();!k.done;k=b.next())f=document.createElement("div"),f.textContent=k.value,m.appendChild(f);return new Promise(function(b,
c){d.classList.add("visible");a=function(a){return"OK"==a?b(e.value):c("Cancel")}})},confirm:function(a){return b("Confirm",a,["OK","Cancel"]).then(function(a){if("OK"!=a)throw"Cancel";})}}}();function I(){if(localStorage){var a=C.map(function(a){return a.label()});localStorage.setItem("timerNames",a.join("|"));localStorage.setItem("state",JSON.stringify(F()))}}
function J(a){function b(){D&&K();e=+new Date;f.push({start:e,stop:e,running:!0});m.classList.add("started");g()}function d(){if(e){var a=+new Date;f[f.length-1].stop=a;f[f.length-1].running=!1;k+=a-e;e=void 0;m.classList.remove("started");g()}}function l(){f.splice(0,f.length);k=h=0;e&&(e=+new Date,f.push({start:e,stop:e,running:!0}));g()}function g(){var a=(k+(e?new Date-e:0))/1E3,b=Math.floor(a/3600),c=String(Math.floor(a%3600/60)),d=String(Math.floor(a%60)),a=Math.round(a%3600/360),l=b;10==a&&
(a=0,l++);2>c.length&&(c="0"+c);2>d.length&&(d="0"+d);L.textContent=l+"."+a+" h";y.textContent=b+":"+c+":"+d;f.length&&f[f.length-1].running&&(f[f.length-1].stop=+new Date)}function c(a){var b=m.getElementsByClassName(a);if(1>b.length)throw Error("could not find child "+a);return b[0]}a=a?a:{};var m=document.querySelector(".template .timer").cloneNode(!0);B.insertBefore(m,B.lastElementChild);for(var e=void 0,h=a.adjust||0,k=h,f=a.history||[],E=z(f),t=E.next();!t.done;t=E.next())t=t.value,k+=t.stop-
t.start;c("name").firstElementChild.value=a.name||"";var L=c("time-hours"),y=c("time-minutes"),G={update:g,reset:l,label:function(){return escape(c("name").firstElementChild.value)+"="+(k+(e?new Date-e:0))/1E3*(e?-1:1)},stop:d,state:function(){return{name:c("name").firstElementChild.value,history:f,adjust:h}}};f.length&&f[f.length-1].running&&b();c("start").addEventListener("click",b);c("pause").addEventListener("click",d);c("reset").addEventListener("click",l);c("delete").addEventListener("click",
function(){m.parentNode.removeChild(m);C.splice(C.indexOf(G),1);I()});c("name").firstElementChild.addEventListener("blur",I);c("time").addEventListener("dblclick",function(){H.prompt("Adjust Time","Please enter a new time","00:00:00").then(function(a){for(var b=a.split(":");3>b.length;)b.unshift("0");for(var b=b.map(Number),c=z(b),d=c.next();!d.done;d=c.next())if(!Number.isInteger(d.value)||3<b.length){H.show("Error",'Could not parse time: "'+a+'"',["OK"]);return}a=1E3*(3600*b[0]+60*b[1]+b[2]);l();
k+=a;h+=a;g()})});C.push(G)}document.getElementsByClassName("new")[0].addEventListener("click",function(){J();I()});document.getElementsByClassName("hours")[0].addEventListener("click",function(){B.classList.remove("hourmode")});document.getElementsByClassName("minutes")[0].addEventListener("click",function(){B.classList.add("hourmode")});document.getElementsByClassName("modal")[0].addEventListener("click",function(){D=!1;B.classList.remove("modal")});
document.getElementsByClassName("non-modal")[0].addEventListener("click",function(){D=!0;B.classList.add("modal")});document.getElementsByClassName("reset-all")[0].addEventListener("click",function(){H.confirm("Reset all timers?").then(function(){C.forEach(function(a){return a.reset()})})});document.body.addEventListener("keypress",function(a){"Enter"==a.key&&a.target.blur()});
var M=function(){if(!localStorage)return{modal:!1,timers:[]};var a=localStorage.getItem("state");if(a)return JSON.parse(a);var b={modal:!1,timers:[]};(localStorage.getItem("timerNames")||"").split("|").forEach(function(a){var d=a.indexOf("="),g={history:[],adjust:0};if(0<=d){var c=1E3*Number(a.substring(d+1));a=a.substring(0,d);0>c&&(c*=-1,d=+new Date,g.history.push({start:d,stop:d,v:!0}));g.adjust=c}a=unescape(a);g.name=a;b.timers.push(g)});return b}();B.classList.toggle("modal",D=M.modal);
B.classList.toggle("hourmode",M.hour);M.timers.forEach(function(a){return J(a)});function K(){C.forEach(function(a){return a.stop()})}function N(){C.forEach(function(a){return a.update()});window.setTimeout(N,250);I()}N();
}).call(this)
