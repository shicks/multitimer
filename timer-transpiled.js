(function(){
'use strict';function m(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}}function p(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):{next:m(a)}}var q="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,t="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,e){a!=Array.prototype&&a!=Object.prototype&&(a[c]=e.value)};
function v(a,c){if(c){var e=q;a=a.split(".");for(var h=0;h<a.length-1;h++){var l=a[h];l in e||(e[l]={});e=e[l]}a=a[a.length-1];h=e[a];c=c(h);c!=h&&null!=c&&t(e,a,{configurable:!0,writable:!0,value:c})}}
v("Promise",function(a){function c(b){this.b=0;this.g=void 0;this.a=[];var d=this.c();try{b(d.resolve,d.reject)}catch(n){d.reject(n)}}function e(){this.a=null}function h(b){return b instanceof c?b:new c(function(d){d(b)})}if(a)return a;e.prototype.b=function(b){if(null==this.a){this.a=[];var d=this;this.c(function(){d.g()})}this.a.push(b)};var l=q.setTimeout;e.prototype.c=function(b){l(b,0)};e.prototype.g=function(){for(;this.a&&this.a.length;){var b=this.a;this.a=[];for(var d=0;d<b.length;++d){var a=
b[d];b[d]=null;try{a()}catch(g){this.f(g)}}}this.a=null};e.prototype.f=function(b){this.c(function(){throw b;})};c.prototype.c=function(){function b(b){return function(d){c||(c=!0,b.call(a,d))}}var a=this,c=!1;return{resolve:b(this.o),reject:b(this.f)}};c.prototype.o=function(b){if(b===this)this.f(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof c)this.s(b);else{a:switch(typeof b){case "object":var a=null!=b;break a;case "function":a=!0;break a;default:a=!1}a?this.m(b):this.i(b)}};
c.prototype.m=function(b){var a=void 0;try{a=b.then}catch(n){this.f(n);return}"function"==typeof a?this.u(a,b):this.i(b)};c.prototype.f=function(b){this.j(2,b)};c.prototype.i=function(b){this.j(1,b)};c.prototype.j=function(b,a){if(0!=this.b)throw Error("Cannot settle("+b+", "+a+"): Promise already settled in state"+this.b);this.b=b;this.g=a;this.l()};c.prototype.l=function(){if(null!=this.a){for(var b=0;b<this.a.length;++b)k.b(this.a[b]);this.a=null}};var k=new e;c.prototype.s=function(b){var a=this.c();
b.h(a.resolve,a.reject)};c.prototype.u=function(a,c){var b=this.c();try{a.call(c,b.resolve,b.reject)}catch(g){b.reject(g)}};c.prototype.then=function(a,d){function b(a,b){return"function"==typeof a?function(b){try{g(a(b))}catch(u){f(u)}}:b}var g,f,e=new c(function(a,b){g=a;f=b});this.h(b(a,g),b(d,f));return e};c.prototype.catch=function(a){return this.then(void 0,a)};c.prototype.h=function(a,c){function b(){switch(d.b){case 1:a(d.g);break;case 2:c(d.g);break;default:throw Error("Unexpected state: "+
d.b);}}var d=this;null==this.a?k.b(b):this.a.push(b)};c.resolve=h;c.reject=function(a){return new c(function(b,c){c(a)})};c.race=function(a){return new c(function(b,c){for(var d=p(a),f=d.next();!f.done;f=d.next())h(f.value).h(b,c)})};c.all=function(a){var b=p(a),e=b.next();return e.done?h([]):new c(function(a,c){function d(b){return function(c){f[b]=c;g--;0==g&&a(f)}}var f=[],g=0;do f.push(void 0),g++,h(e.value).h(d(f.length-1),c),e=b.next();while(!e.done)})};return c});
v("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}});v("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}});var w=document.getElementsByClassName("timers")[0],x=[],y=!1;function z(){return{timers:x.map(function(a){return a.state()}),modal:y,hour:!!w&&w.classList.contains("hourmode")}}
var B=function(){function a(){}function c(c,d,f){h.classList.remove("prompt");l.textContent=c;for(k.textContent=d;b.firstChild;)b.removeChild(b.firstChild);c=p(f);for(d=c.next();!d.done;d=c.next())f=document.createElement("div"),f.textContent=d.value,b.appendChild(f);return new Promise(function(b){e.classList.add("visible");a=function(a){return b(a)}})}var e=document.querySelector(".modal-barrier"),h=e.querySelector(".dialog"),l=e.querySelector(".title"),k=e.querySelector(".text"),b=e.querySelector(".buttons"),
d=e.querySelector(".prompt");b.addEventListener("click",function(c){c.target.parentNode==b&&(a(c.target.textContent),a=function(){},e.classList.remove("visible"))});return{show:c,prompt:function(c,g,f){f=void 0===f?"":f;h.classList.add("prompt");d.value="";d.placeholder=f;l.textContent=c;for(k.textContent=g;b.firstChild;)b.removeChild(b.firstChild);c=p(["OK","Cancel"]);for(g=c.next();!g.done;g=c.next())f=document.createElement("div"),f.textContent=g.value,b.appendChild(f);return new Promise(function(b,
c){e.classList.add("visible");a=function(a){return"OK"==a?b(d.value):c("Cancel")}})},confirm:function(a){return c("Confirm",a,["OK","Cancel"]).then(function(a){if("OK"!=a)throw"Cancel";})}}}();function C(){if(localStorage){var a=x.map(function(a){return a.label()});localStorage.setItem("timerNames",a.join("|"));localStorage.setItem("state",JSON.stringify(z()))}}
function D(a){function c(){y&&E();d=+new Date;f.push({start:d,stop:d,running:!0});b.classList.add("started");l()}function e(){if(d){var a=+new Date;f[f.length-1].stop=a;f[f.length-1].running=!1;g+=a-d;d=void 0;b.classList.remove("started");l()}}function h(){f.splice(0,f.length);g=n=0;d&&(d=+new Date,f.push({start:d,stop:d,running:!0}));l()}function l(){var a=(g+(d?new Date-d:0))/1E3,b=Math.floor(a/3600),c=String(Math.floor(a%3600/60)),e=String(Math.floor(a%60));a=Math.round(a%3600/360);var h=b;10==
a&&(a=0,h++);2>c.length&&(c="0"+c);2>e.length&&(e="0"+e);F.textContent=h+"."+a+" h";G.textContent=b+":"+c+":"+e;f.length&&f[f.length-1].running&&(f[f.length-1].stop=+new Date)}function k(a){var c=b.getElementsByClassName(a);if(1>c.length)throw Error("could not find child "+a);return c[0]}a=void 0===a?{}:a;var b=document.querySelector(".template .timer").cloneNode(!0);w.insertBefore(b,w.lastElementChild);for(var d=void 0,n=a.adjust||0,g=n,f=a.history||[],A=p(f),r=A.next();!r.done;r=A.next())r=r.value,
g+=r.stop-r.start;k("name").firstElementChild.value=a.name||"";var F=k("time-hours"),G=k("time-minutes"),u={update:l,reset:h,label:function(){return escape(k("name").firstElementChild.value)+"="+(g+(d?new Date-d:0))/1E3*(d?-1:1)},stop:e,state:function(){return{name:k("name").firstElementChild.value,history:f,adjust:n}}};f.length&&f[f.length-1].running&&c();k("start").addEventListener("click",c);k("pause").addEventListener("click",e);k("reset").addEventListener("click",h);k("delete").addEventListener("click",
function(){b.parentNode.removeChild(b);x.splice(x.indexOf(u),1);C()});k("name").firstElementChild.addEventListener("blur",C);k("time").addEventListener("dblclick",function(){B.prompt("Adjust Time","Please enter a new time","00:00:00").then(function(a){for(var b=a.split(":");3>b.length;)b.unshift("0");b=b.map(Number);for(var c=p(b),d=c.next();!d.done;d=c.next())if(!Number.isInteger(d.value)||3<b.length){B.show("Error",'Could not parse time: "'+a+'"',["OK"]);return}a=1E3*(3600*b[0]+60*b[1]+b[2]);h();
g+=a;n+=a;l()})});x.push(u)}document.getElementsByClassName("new")[0].addEventListener("click",function(){D();C()});document.getElementsByClassName("hours")[0].addEventListener("click",function(){w.classList.remove("hourmode")});document.getElementsByClassName("minutes")[0].addEventListener("click",function(){w.classList.add("hourmode")});document.getElementsByClassName("modal")[0].addEventListener("click",function(){y=!1;w.classList.remove("modal")});
document.getElementsByClassName("non-modal")[0].addEventListener("click",function(){y=!0;w.classList.add("modal")});document.getElementsByClassName("reset-all")[0].addEventListener("click",function(){B.confirm("Reset all timers?").then(function(){x.forEach(function(a){return a.reset()})})});document.body.addEventListener("keypress",function(a){"Enter"==a.key&&a.target.blur()});
var H=function(){if(!localStorage)return{modal:!1,timers:[]};var a=localStorage.getItem("state");if(a)return JSON.parse(a);var c={modal:!1,timers:[]};(localStorage.getItem("timerNames")||"").split("|").forEach(function(a){var e=a.indexOf("="),l={history:[],adjust:0};if(0<=e){var k=1E3*Number(a.substring(e+1));a=a.substring(0,e);0>k&&(k*=-1,e=+new Date,l.history.push({start:e,stop:e,v:!0}));l.adjust=k}a=unescape(a);l.name=a;c.timers.push(l)});return c}();w.classList.toggle("modal",y=H.modal);
w.classList.toggle("hourmode",H.hour);H.timers.forEach(function(a){return D(a)});function E(){x.forEach(function(a){return a.stop()})}function I(){x.forEach(function(a){return a.update()});window.setTimeout(I,250);C()}I();
}).call(this)
